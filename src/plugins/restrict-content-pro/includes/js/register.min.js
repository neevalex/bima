var rcp_processing=!1;function rcp_get_gateway(){let e,t=jQuery;return t("#rcp_payment_gateways").length>0?(e=t("#rcp_payment_gateways select option:selected")).length<1&&(e=t('input[name="rcp_gateway"]:checked')):e=t('input[name="rcp_gateway"]'),e}function rcp_get_registration_form_state(){let e=jQuery,t=e("#rcp_subscription_levels input:checked");return t.length||(t=e("#rcp_registration_form").find("input[name=rcp_level]")),{membership_level:t.val(),is_free:0==t.attr("rel"),lifetime:"forever"===t.data("duration"),level_has_trial:-1!==rcp_script_options.trial_levels.indexOf(t.val()),discount_code:e("#rcp_discount_code").val(),gateway:rcp_get_gateway().val(),gateway_data:rcp_get_gateway(),auto_renew:e("#rcp_auto_renew").prop("checked")}}function rcp_validate_registration_state(e,t){e||(e=rcp_get_registration_form_state());let a=jQuery;a("#rcp_registration_form").block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),a.ajax({type:"post",dataType:"json",url:rcp_script_options.ajaxurl,data:{action:"rcp_validate_registration_state",rcp_level:e.membership_level,lifetime:e.lifetime,level_has_trial:e.level_has_trial,is_free:e.is_free,discount_code:e.discount_code,rcp_gateway:e.gateway,rcp_auto_renew:!0===e.auto_renew||"",event_type:t,registration_type:a("#rcp-registration-type").val(),membership_id:a("#rcp-membership-id").val()},success:function(e){e.success?(a(".rcp_gateway_"+e.data.gateway+"_fields").length&&e.data.show_gateway_fields||(a("#rcp_gateway_extra_fields").remove(),1==e.data.show_gateway_fields&&e.data.gateway_fields&&(a(".rcp_gateway_fields").length?a('<div class="rcp_gateway_'+e.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+e.data.gateway_fields+"</div>").insertAfter(".rcp_gateway_fields"):a('<div class="rcp_gateway_'+e.data.gateway+'_fields" id="rcp_gateway_extra_fields">'+e.data.gateway_fields+"</div>").insertAfter(".rcp_gateways_fieldset"),a("body").trigger("rcp_gateway_loaded",e.data.gateway))),rcp_prepare_registration_fields(e.data)):console.log(e),a("#rcp_registration_form").unblock()}})}function rcp_prepare_registration_fields(e){let t=jQuery;if(e.recurring_available?t("#rcp_auto_renew_wrap").show():(t("#rcp_auto_renew_wrap").hide(),t("#rcp_auto_renew_wrap input").prop("checked",!1)),e.level_has_trial&&e.trial_eligible&&(t("#rcp_auto_renew_wrap").hide(),t("#rcp_auto_renew_wrap input").prop("checked",!0)),e.initial_total>0||e.recurring_total>0?t(".rcp_gateway_fields").show():t(".rcp_gateway_fields").hide(),e.show_gateway_fields?t("#rcp_gateway_extra_fields").show():t("#rcp_gateway_extra_fields").remove(),t(".rcp_discount_amount").remove(),t(".rcp_discount_valid, .rcp_discount_invalid").hide(),e.discount_code){e.discount_valid?(t(".rcp_discount_valid").show(),t("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+e.discount_amount+"</span>"),e.full_discount?t(".rcp_gateway_fields").addClass("rcp_discounted_100"):t(".rcp_gateway_fields").removeClass("rcp_discounted_100")):(t(".rcp_discount_invalid").show(),t(".rcp_gateway_fields").removeClass("rcp_discounted_100"));let a={valid:e.discount_valid,full:e.full_discount,amount:e.discount_amount};t("body").trigger("rcp_discount_applied",[a])}t(".rcp_registration_total").html(e.total_details_html)}function rcp_validate_recaptcha(e){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!1)}jQuery(document).ready(function(e){rcp_validate_registration_state(),e("#rcp-membership-renew-upgrade-toggle").on("click",function(t){t.preventDefault(),e("#rcp-membership-renew-upgrade-choice").toggle()}),e("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){e("body").trigger("rcp_gateway_change",{gateway:rcp_get_gateway().val()})}),e(".rcp_level").change(function(){e("body").trigger("rcp_level_change",{subscription_level:e("#rcp_subscription_levels input:checked").val()})}),e("#rcp_apply_discount").on("click",function(t){t.preventDefault(),e("body").trigger("rcp_discount_change",{discount_code:e("#rcp_discount_code").val()})}),e("#rcp_auto_renew").on("change",function(){e("body").trigger("rcp_auto_renew_change",{auto_renew:e(this).prop("checked")})}),e("body").on("rcp_discount_change rcp_level_change rcp_gateway_change rcp_auto_renew_change",function(e,t){rcp_validate_registration_state(Object.assign({},rcp_get_registration_form_state(),t),e.type)}),"1"===rcp_script_options.recaptcha_enabled&&jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!0),e(document).on("click","#rcp_registration_form #rcp_submit",function(t){t.preventDefault();var a=document.getElementById("rcp_registration_form"),r=e("#rcp_registration_form");r.attr("id");if("function"!=typeof a.checkValidity||!1!==a.checkValidity()){e(this).val();r.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),e("#rcp_submit",r).val(rcp_script_options.pleasewait),rcp_processing||(rcp_processing=!0,e.post(rcp_script_options.ajaxurl,r.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(t){e(".rcp-submit-ajax",r).remove(),e(".rcp_message.error",r).remove()}).success(function(e){}).done(function(e){}).fail(function(e){console.log(e)}).always(function(e){}))}}),e(document).ajaxComplete(function(t,a,r){if(!r.hasOwnProperty("data")||-1===r.data.indexOf("rcp_process_register_form"))return;if(!a.hasOwnProperty("responseJSON")||!a.responseJSON.hasOwnProperty("data"))return;if(!0!==a.responseJSON.data.success)return e("#rcp_registration_form #rcp_submit").val(rcp_script_options.register),e("#rcp_registration_form #rcp_submit").before(a.responseJSON.data.errors),e("#rcp_registration_form #rcp_register_nonce").val(a.responseJSON.data.nonce),e("#rcp_registration_form").unblock(),void(rcp_processing=!1);let i=!1;a.responseJSON.data.gateway.supports&&-1!==a.responseJSON.data.gateway.supports.indexOf("gateway-submits-form")&&(i=!0),e("body").trigger("rcp_register_form_submission",[a.responseJSON.data,t.target.forms.rcp_registration_form.id]),(0===a.responseJSON.data.total&&0===a.responseJSON.data.recurring_total||!i)&&document.getElementById("rcp_registration_form").submit()})});var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_calculating_total=!1;function rcp_validate_form(e){rcp_validate_registration_state()}function rcp_validate_subscription_level(){rcp_validating_level||(rcp_validating_level=!0,rcp_validate_registration_state(),rcp_validating_level=!1)}function rcp_validate_gateways(){rcp_validating_gateway||(rcp_validating_gateway=!0,rcp_validate_registration_state(),rcp_validating_gateway=!1)}function rcp_validate_discount(){rcp_validating_discount||(rcp_validating_discount=!0,rcp_validate_registration_state(),rcp_validating_discount=!1)}function rcp_calc_total(){rcp_calculating_total||(rcp_calculating_total=!0,rcp_validate_registration_state(),rcp_calculating_total=!1)}